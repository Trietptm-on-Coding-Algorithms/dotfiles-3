#!/usr/bin/env sh
# Author: Nathan Farrar <nfarrar@crunk.io>
# Description: postconvert script for youtube-dl {{{
#
# ffmpeg -i input.flv -c copy -copyts output.mp4
# ffmpeg -i filename.flv -c:v libx264 -crf 19 -strict experimental filename.mp4
#
#  - https://gist.github.com/boltronics/b23cf2b83d7af6cb8938
#
# }}}


# Convert flv to mkv
filename=$( basename "$1" )
extension="${filename##*.}"
filename="${filename%.*}"
dirname=$( dirname "$1" )

result=$1
if [[ "$extension" == "flv" ]]; then
  out="$dirname/$filename.mkv"
  ffmpeg -i "$1" -c copy "$out"

  if [[ $? == 0 ]]; then
    rm "$1"
    result=$out
  fi
fi

# tag -a "" "$result"
